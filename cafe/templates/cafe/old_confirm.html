{% extends 'order.html' %} 

{% load post_extras %}
{% block content %}


<script>  
    function pay_now() { 
        var form = document.getElementById("confirmed_order_submission");
        var parm = new Array();

        let carts = [
                    {% for item in cart_all %}
                        {
                            id: "{{ item.id }}",
                        },
                    {% endfor %}
                ]
        var orders = new Array();
        for (let i=0; i < carts.length; i++){
            orders.push(carts[i].id);
        }
        console.log(orders);
        parm.push( ['usage_type', "{{usage_type|safe}}"] );
        parm.push( ['orders', orders] );
        parm.push( ['total_price', "{{total_price|safe}}"] );

        var input = new Array();
        for (var i = 0; i < parm.length; i++) {
            input[i] = document.createElement("input");
            input[i].setAttribute("type", "hidden");
            input[i].setAttribute('name', parm[i][0]);
            input[i].setAttribute("value", parm[i][1]);
            form.appendChild(input[i]);
        }
        document.body.appendChild(form);
        form.submit();
    }

</script>

<style>
    #totalPrice {
        width: 1200px;
        border-style: solid;
        border-color: gray;
        border-width: 0px 0px 2px 0px;
        margin: 0 0 0 0;
        align-items : center;
        display : flex;
        padding: 3% 0 0 0;
    }
</style>

<!-- Header-->
<div class="py-3">
	<div class="container px-1">
        <div class="payment">
            <div class="row">
                <div id="pay-cancel" class="py-5" OnClick="window.history.back();" style="cursor:pointer;" >
                    <h1 class="display-3 fw-bolder text-danger">< 취소하기</h1>
                </div>
        <h1 class="display-3 fw-bolder mt-5 mb-2">주문 내역</h1><br>  
            </div>
        </div>
        
		<section class="py-3">
            <div class="container my-5 py-5">
                <div class="row gx-3"> 
                    {% for item in cart_all %} 
                        <div class='col-lg-4 col-4 mt-5'>
                            <div class='card h-100 border-1'>
                                <img class='card-img-top' src={{item.menu.image|fix_route|default:'https://dummyimage.com/600x400/403f40/d4d4d4.png'}} />
                                <div class='card-body'>
                                    <a class='text-decoration-none link-dark stretched-link text-center'>
                                        <h5 class='card-title mb-3'>
                                            <strong>{{item.menu.title}} </strong>
                                        </h5>
                                    </a>
                                    <p class='card-text mb-0 text-center'>수량 : {{item.count}}</p>
                                </div>
                            </div>
                        </div> 
                    {% endfor %} 
                </div>
            </div>
        </section>
	</div>
</div>
{% endblock content %}
            
{% block cart %}

<style>
    .bottombar {
        position: fixed;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1030;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        padding-top: 0.5rem;
        padding-bottom: 0rem;
      }
    .cart-info {
        border-radius: 35px 35px 0px 0px; 
        width: 100%; 
        padding: 1rem 1rem;
    }
    .payment {
        width: 100%; 
    }
    #cash-pay, #card-pay {
        width: 50%; 
        height: 400px;
        text-align: center;
        padding-top: 1rem;
-    }
    #pay-cancel {
    width: 50%; 
    height: 200px;
    padding-top: 1rem;
-    }
    #pay-cancel {
        color: #000000;
        background-color: #ffffff;
    }
    #cash-pay #card-pay {
        color: #ffffff;
        background-color: #CC3939;
    }
    #pay-cancel:hover {
        color: #000000;
        background-color: #ffffff;
    }
    #pay:hover {
        color: #ffffff;
        background-color: #9B111E;
    }
    #cart-list > * {
        color: #fff;
        text-align: center;
        font-size: 1.25rem;
        padding-bottom: 0.5rem;
        
    }
    #cartElement {
        text-align: left;
        padding-left: 2rem;
    }
</style>

<section class="bottombar">
    <div class="row gx-9 gx-lg-9" id="totalPrice">
        <div class="col-7"><h1 class="display-5 fw-bolder mt-3 mb-4">&nbsp;&nbsp;&nbsp;총 주문 금액</h1></div>
        <div class="col-5"><h1 class="display-5 fw-bolder mt-3 mb-4 text-end">{{total_price|default:0}}원&nbsp;&nbsp;&nbsp;</h1></div>
    </div>
    <form id="confirmed_order_submission" action="{% url 'cafe:old_pay' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
    </form>

    <div class="payment">
        <div class="row">
            <h1 class="display-3 fw-bolder mt-3 mb-4">결제 수단선택</h1></div>
            <div id="cash-pay" class="py-5" OnClick="window.history.back();" style="cursor:pointer;" >
                <h1 class="display-1 fw-bolder"><br>현금결제</h1>
            </div>
            <div id="card-pay" class="py-5" OnClick="pay_now();" style="cursor:pointer;">
                <h1 class="display-1 fw-bolder"><br>카드결제</h1>
            </div>
        </div>
    </div>
   

</section>

{% endblock cart%}

{% block bar %}

<style>
    .cart-py-5 {
        padding-top: 9rem !important;
        padding-bottom: 1rem !important;
    }
    .sidebar-py-5 {
        padding-top: 6rem !important;
        padding-bottom: 3rem !important;
    }

</style>

<div class="portfolio-item mx-auto">
    <!-- Product details-->
    <div class="card-body cart-py-5">
        <div class="text-center text-light-muted">
            <div id="bar--cart" class="text-center">
                <h1 class="fw-bolder" style="color: #F25168; margin: 0 0 -1.5rem;">0</h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" fill="#F25168" class="bi bi-cart4" viewBox="0 0 16 16">
                    <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                </svg>
                <div class="row">
                    <h2 class="col-5 fw-bolder" style="color: #F25168; text-align: right; padding-right: 10%;">￦</h2>
                    <h2 class="col-7 fw-bolder" id="total-money" style="color: #F25168; text-align: left; padding-left: 5%;">0</h2>
                </div>

            </div>
        </div>
        
    </div>
    <div class="card-body sidebar-py-5">
        <div class="text-center text-light-muted">
            <div id="bar--drink">
                <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" fill="currentColor" class="bi bi-cup-straw" viewBox="0 0 16 16">
                    <path d="M13.902.334a.5.5 0 0 1-.28.65l-2.254.902-.4 1.927c.376.095.715.215.972.367.228.135.56.396.56.82 0 .046-.004.09-.011.132l-.962 9.068a1.28 1.28 0 0 1-.524.93c-.488.34-1.494.87-3.01.87-1.516 0-2.522-.53-3.01-.87a1.28 1.28 0 0 1-.524-.93L3.51 5.132A.78.78 0 0 1 3.5 5c0-.424.332-.685.56-.82.262-.154.607-.276.99-.372C5.824 3.614 6.867 3.5 8 3.5c.712 0 1.389.045 1.985.127l.464-2.215a.5.5 0 0 1 .303-.356l2.5-1a.5.5 0 0 1 .65.278zM9.768 4.607A13.991 13.991 0 0 0 8 4.5c-1.076 0-2.033.11-2.707.278A3.284 3.284 0 0 0 4.645 5c.146.073.362.15.648.222C5.967 5.39 6.924 5.5 8 5.5c.571 0 1.109-.03 1.588-.085l.18-.808zm.292 1.756C9.445 6.45 8.742 6.5 8 6.5c-1.133 0-2.176-.114-2.95-.308a5.514 5.514 0 0 1-.435-.127l.838 8.03c.013.121.06.186.102.215.357.249 1.168.69 2.438.69 1.27 0 2.081-.441 2.438-.69.042-.029.09-.094.102-.215l.852-8.03a5.517 5.517 0 0 1-.435.127 8.88 8.88 0 0 1-.89.17zM4.467 4.884s.003.002.005.006l-.005-.006zm7.066 0-.005.006c.002-.004.005-.006.005-.006zM11.354 5a3.174 3.174 0 0 0-.604-.21l-.099.445.055-.013c.286-.072.502-.149.648-.222z"/>
                </svg>
                <h1 class="text-light-muted fw-bolder" style="color: #F25168;">DRINK</h1>
            </div>
        </div>
        
    </div>

    <div class="card-body sidebar-py-5">
        <div class="text-center text-light-muted">
            <div id="bar--bread">
                <svg xmlns="http://www.w3.org/2000/svg" width="130" height="130" fill="currentColor" viewBox="0 0 512 512">
                    <path d="M256 32C192 32 0 64 0 192c0 35.3 28.7 64 64 64V432c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V256c35.3 0 64-28.7 64-64C512 64 320 32 256 32z"/>
                </svg>
                
                <h1 class="text-light-muted fw-bolder">BREAD</h1>
            </div>
        </div>
        
    </div>

    <div class="card-body sidebar-py-5">
        <div class="text-center text-light-muted">
            <img width="150" height="150" src="/static/assets/temp_logo.PNG" alt="logo" style="border-radius: 50%;"/>
        </div>
        
    </div>

</div>


<script>
        
    let addCartButton = document.querySelectorAll('[id^=addToCart]');
    // 장바구니 담기 처리
    const addCartButtonClickHandle = (e) =>{
        e.preventDefault();
        
        let id = e.target.id.split("--")[1];
        console.log("add " + id);
        
        // 주문한 상품 총 개수 수정
        var count = document.querySelector("#bar--cart > h1").innerText;
        count *= 1;
        document.querySelector("#bar--cart > h1").innerText = count + 1;

        // 주문 금액 수정
        var price = document.getElementById(id + '--price').innerText.split(' ')[0];
        price *= 1;

        var totalPrice = document.getElementById('total-money').innerText;
        totalPrice *= 1;
        document.getElementById('total-money').innerHTML = (totalPrice + price);

    }
    for(let i=0;i<addCartButton.length;i++){
        addCartButton[i].addEventListener('click', addCartButtonClickHandle);
    }
</script>


{% endblock %}