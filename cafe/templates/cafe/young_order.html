{% extends 'order.html' %} 

{% load post_extras %}
{% block content %}

<script>  
    // GET 방식으로 전송된 데이터 읽기
    $.extend({
        getUrlVars: function(){
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') +1).split('&');
            for(var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            console.log(vars);
            return vars;
        }, 
        
        getUrlVar: function(name) {
            return $.getUrlVars()[name];
        }
        
    });

    function order_now() {
        let cart_items = document.querySelectorAll('[id^=cart--]');
        if (cart_items.length == 0){
            alert("장바구니가 비어있습니다.");
            return
        }

        let menu_list = new Array();
        let menu_counts = new Array();
        
        for (let i=0;i<cart_items.length;i++){
            var menu_id = cart_items[i].id.split("--")[1];
            var cnt = document.getElementById(menu_id + '--count').innerText * 1; 
            console.log(cnt);

            menu_list.push(menu_id);
            menu_counts.push(cnt);
        }
        var usage_type = $.getUrlVar('usage_type');

        var form = document.getElementById("order_submission");
        var parm = new Array();
        parm.push( ['usage_type', usage_type] );
        parm.push( ['menu_list', menu_list] );
        parm.push( ['menu_counts', menu_counts] );

        var input = new Array();
        for (var i = 0; i < parm.length; i++) {
            input[i] = document.createElement("input");
            input[i].setAttribute("type", "hidden");
            input[i].setAttribute('name', parm[i][0]);
            input[i].setAttribute("value", parm[i][1]);
            form.appendChild(input[i]);
        }
        document.body.appendChild(form);
        form.submit();
    }

</script>


<style>
    .page-heading {
        font-size: 3rem;
        line-height: 5rem;
    }
    .tab_title li {
        font-weight: 700 !important;
        text-align: center !important;
        text-transform: uppercase !important;
        font-size: 2.5rem;
        list-style: none;
        color: #949292;
        cursor: pointer;
        padding: 20px 38px;
        display: inline-block;
        margin: 0 0 2rem;
        border-radius: 0.5rem;
      }
      
    .tab_title li.on, .tab_title li:hover{
        color: #FFFFFF;
        background-color: #E51937;
        font-weight: bold;
        border: 5px solid #F5BDBD;
        box-shadow: 0 0 0 0.25rem F5BDBD;
      }
    
    .tab_cont {
        clear: both;
        border: 1px solid #dedede;
        background-color: #cecece;
    }

    .tab_cont div {
        text-align: center;
    }

    .tab_cont div.on{
        display: block;
    }
</style>

<style>
    .btn-in-modal{
        color: #FFFFFF;
        font-weight: 600 !important;
        text-align: center !important;
        padding: 20px 240px;
        font-size: 2rem;
        border-radius: 4rem;
    }

    .bestmenu, .bestmenu_detail {
        display: inline-block;
        padding: 0.35em 0.65em;
        font-size: 0.9em;
        font-weight: 700;
        line-height: 1;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 0.2rem;
        position: relative;
        top: -1px;
    }
    .bestmenu {
        font-size: 0.9em;
        font-weight: 700;
        line-height: 1;
    }
    .bestmenu_detail {
        font-size: 1.5em;
        font-weight: 1000;
        line-height: 1;
    }
    .bestmenu:empty, .bestmenu_detail:empty {
        display: none;
    }
    .order-py-5 {
        padding-top: 3rem !important;
    }
    .menu-modal-title {
        font-size: 4rem;
        line-height: 4rem;
        font-weight: 900 !important;
        margin-bottom: 2rem !important;
    }
    .menu-modal-desc {
        font-size: 2rem;
        line-height: 3rem;
        font-weight: 500 !important;
        margin-bottom: 3rem !important;

    }
    .menu-modal-en-title{
        font-size: 2.5rem;
        line-height: 3rem;
        font-weight: 700 !important;
        margin-bottom: 2rem !important;
    }

</style>

<!-- Navigation-->
<nav class="navbar-expand-lg order-py-5">
    <div class="container px-4 px-lg-5">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <p class="page-heading fw-bold text-primary">
                <i class="bi bi-chevron-left"></i> MENU
            </p>
            
        </div>
    </div>
</nav>

<section class="my-md-5">
    <div class="row justify-content-center mb-5">            
        <!-- Portfolio Grid Items-->
        <ul class="tab_title py-5 text-center" style="text-align:center;">
            <li class="on" id="menu_type--hotcoffee">
                Hot coffee
            </li>
            <li id="menu_type--icecoffee">
                Ice coffee
            </li>
            <li id="menu_type--noncoffee">
                Non Coffee
            </li>
            <li id="menu_type--smoothie">
                Smoothie
            </li>
        </ul>    
        
    </div>
    <div class="row justify-content-center"> 
            
        <div class="row justify-content-center" id="menu_content--hotcoffee" style="display: auto;">
            {% for menu in hot_coffee_all %}
                <div class="col-md-4 col">
                    <div class="portfolio-item mx-auto" data-bs-toggle="modal" data-bs-target="#portfolioModal{{menu.id}}">
                        <div class="portfolio-item-caption d-flex align-items-center justify-content-center h-100 w-100">
                            <div class="portfolio-item-caption-content text-center text-white"><i class="fas fa-plus fa-3x"></i></div>
                        </div>
                        <!-- Product image-->
                        <img class="card-img-top" src="{{menu.image|fix_route|default:'https://dummyimage.com/450x300/dee2e6/6c757d.jpg'}}" alt="..." />
                        <!-- Product details-->
                        <div class="card-body p-4">
                            <div class="text-center">
                                {% if menu.is_best_menu %}
                                    <div class='bestmenu bg-primary bg-gradient rounded-pill mb-2'>BEST MENU</div>
                                {% endif %}

                                <!-- Menu name-->
                                <h1 class="fw-bolder">{{menu.title}}</h1>
                                <!-- Menu price-->
                                <h2 class="fw-normal" id="{{menu.title}}--price">{{menu.price}} 원</h2>
                                <!-- Menu Calorie-->
                                <h3 class="fw-light text-muted">{{menu.calorie}} Kcal</h3>
                                
                            </div>
                        </div>
    
                    </div>
                </div>
                <div class="portfolio-modal modal fade" id="portfolioModal{{menu.id}}" tabindex="-1" aria-labelledby="portfolioModal{{menu.id}}" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header border-0"><button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button></div>
                            <div class="modal-body text-center pb-5">
                                <div class="container">
                                    <div class="row justify-content-center">
                                        <div class="col-lg-8">
                                            {% if menu.is_best_menu %}
                                                <div class='bestmenu_detail bg-primary bg-gradient rounded-pill mb-2'>BEST MENU</div>
                                            {% endif %}

                                            <!-- Portfolio Modal - Image-->
                                            <img class="img-fluid rounded mb-5" src="{{menu.image|fix_route|default:'https://dummyimage.com/450x300/dee2e6/6c757d.jpg'}}" alt="..." />

                                            <div style="text-align: left;">
                                                <!-- Portfolio Modal - Title-->
                                                <h1 class="menu-modal-title text-secondary text-uppercase">{{menu.title}}</h1>
                                                <h1 class="menu-modal-en-title text-secondary text-uppercase">{{menu.en_title|default:'AMERICANO'}}</h1><br>

                                                <!-- Portfolio Modal - Text-->
                                                <p class="mb-4 menu-modal-desc">{{menu.desc}}</p>
                                            </div>
                                            <button class="btn btn-in-modal btn-primary" data-bs-dismiss="modal" id="addToCart--{{menu.title}}">
                                                <i class="fas fa-xmark fa-fw"></i>
                                                장바구니 담기
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="row justify-content-center" id="menu_content--icecoffee" style="display: none;">
            {% for menu in ice_coffee_all %}
                <div class="col-md-4 col">
                    <div class="portfolio-item mx-auto" data-bs-toggle="modal" data-bs-target="#portfolioModal{{menu.id}}">
                        <div class="portfolio-item-caption d-flex align-items-center justify-content-center h-100 w-100">
                            <div class="portfolio-item-caption-content text-center text-white"><i class="fas fa-plus fa-3x"></i></div>
                        </div>
                        <!-- Product image-->
                        <img class="card-img-top" src="{{menu.image|fix_route|default:'https://dummyimage.com/450x300/dee2e6/6c757d.jpg'}}" alt="..." />
                        <!-- Product details-->
                        <div class="card-body p-4">
                            <div class="text-center">
                                {% if menu.is_best_menu %}
                                    <div class='bestmenu bg-primary bg-gradient rounded-pill mb-2'>BEST MENU</div>
                                {% endif %}
                                <!-- Menu name-->
                                <h1 class="fw-bolder">{{menu.title}}</h1>
                                <!-- Menu price-->
                                <h2 class="fw-normal" id="{{menu.title}}--price">{{menu.price}} 원</h2>
                                <!-- Menu Calorie-->
                                <h3 class="fw-light text-muted">{{menu.calorie}} Kcal</h3>
                                
                            </div>
                        </div>
    
                    </div>
                </div>
                <div class="portfolio-modal modal fade" id="portfolioModal{{menu.id}}" tabindex="-1" aria-labelledby="portfolioModal{{menu.id}}" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header border-0"><button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button></div>
                            <div class="modal-body text-center pb-5">
                                <div class="container">
                                    <div class="row justify-content-center">
                                        <div class="col-lg-8">
                                            {% if menu.is_best_menu %}
                                                <div class='bestmenu_detail bg-primary bg-gradient rounded-pill mb-2'>BEST MENU</div>
                                            {% endif %}

                                            <!-- Portfolio Modal - Image-->
                                            <img class="img-fluid rounded mb-5" src="{{menu.image|fix_route|default:'https://dummyimage.com/450x300/dee2e6/6c757d.jpg'}}" alt="..." />

                                            <div style="text-align: left;">
                                                <!-- Portfolio Modal - Title-->
                                                <h1 class="menu-modal-title text-secondary text-uppercase">{{menu.title}}</h1>
                                                <h1 class="menu-modal-en-title text-secondary text-uppercase">{{menu.en_title|default:'AMERICANO'}}</h1><br>

                                                <!-- Portfolio Modal - Text-->
                                                <p class="mb-4 menu-modal-desc">{{menu.desc}}</p>
                                            </div>
                                            <button class="btn btn-in-modal btn-primary" data-bs-dismiss="modal" id="addToCart--{{menu.title}}">
                                                <i class="fas fa-xmark fa-fw"></i>
                                                장바구니 담기
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="row justify-content-center" id="menu_content--noncoffee" style="display: none;">
            {% for menu in non_coffee_all %}
                <div class="col-md-4 col">
                    <div class="portfolio-item mx-auto" data-bs-toggle="modal" data-bs-target="#portfolioModal{{menu.id}}">
                        <div class="portfolio-item-caption d-flex align-items-center justify-content-center h-100 w-100">
                            <div class="portfolio-item-caption-content text-center text-white"><i class="fas fa-plus fa-3x"></i></div>
                        </div>
                        <!-- Product image-->
                        <img class="card-img-top" src="{{menu.image|fix_route|default:'https://dummyimage.com/450x300/dee2e6/6c757d.jpg'}}" alt="..." />
                        <!-- Product details-->
                        <div class="card-body p-4">
                            <div class="text-center">
                                {% if menu.is_best_menu %}
                                    <div class='bestmenu bg-primary bg-gradient rounded-pill mb-2'>BEST MENU</div>
                                {% endif %}
                                <!-- Menu name-->
                                <h1 class="fw-bolder">{{menu.title}}</h1>
                                <!-- Menu price-->
                                <h2 class="fw-normal" id="{{menu.title}}--price">{{menu.price}} 원</h2>
                                <!-- Menu Calorie-->
                                <h3 class="fw-light text-muted">{{menu.calorie}} Kcal</h3>
                                
                            </div>
                        </div>
    
                    </div>
                </div>
                <div class="portfolio-modal modal fade" id="portfolioModal{{menu.id}}" tabindex="-1" aria-labelledby="portfolioModal{{menu.id}}" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header border-0"><button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button></div>
                            <div class="modal-body text-center pb-5">
                                <div class="container">
                                    <div class="row justify-content-center">
                                        <div class="col-lg-8">
                                            {% if menu.is_best_menu %}
                                                <div class='bestmenu_detail bg-primary bg-gradient rounded-pill mb-2'>BEST MENU</div>
                                            {% endif %}

                                            <!-- Portfolio Modal - Image-->
                                            <img class="img-fluid rounded mb-5" src="{{menu.image|fix_route|default:'https://dummyimage.com/450x300/dee2e6/6c757d.jpg'}}" alt="..." />

                                            <div style="text-align: left;">
                                                <!-- Portfolio Modal - Title-->
                                                <h1 class="menu-modal-title text-secondary text-uppercase">{{menu.title}}</h1>
                                                <h1 class="menu-modal-en-title text-secondary text-uppercase">{{menu.en_title|default:'AMERICANO'}}</h1><br>

                                                <!-- Portfolio Modal - Text-->
                                                <p class="mb-4 menu-modal-desc">{{menu.desc}}</p>
                                            </div>
                                            <button class="btn btn-in-modal btn-primary" data-bs-dismiss="modal" id="addToCart--{{menu.title}}">
                                                <i class="fas fa-xmark fa-fw"></i>
                                                장바구니 담기
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="row justify-content-center" id="menu_content--smoothie" style="display: none;">
            {% for menu in smoothie_all %}
                <div class="col-md-4 col">
                    <div class="portfolio-item mx-auto" data-bs-toggle="modal" data-bs-target="#portfolioModal{{menu.id}}">
                        <div class="portfolio-item-caption d-flex align-items-center justify-content-center h-100 w-100">
                            <div class="portfolio-item-caption-content text-center text-white"><i class="fas fa-plus fa-3x"></i></div>
                        </div>
                        <!-- Product image-->
                        <img class="card-img-top" src="{{menu.image|fix_route|default:'https://dummyimage.com/450x300/dee2e6/6c757d.jpg'}}" alt="..." />
                        <!-- Product details-->
                        <div class="card-body p-4">
                            <div class="text-center">
                                {% if menu.is_best_menu %}
                                    <div class='bestmenu bg-primary bg-gradient rounded-pill mb-2'>BEST MENU</div>
                                {% endif %}
                                <!-- Menu name-->
                                <h1 class="fw-bolder">{{menu.title}}</h1>
                                <!-- Menu price-->
                                <h2 class="fw-normal" id="{{menu.title}}--price">{{menu.price}} 원</h2>
                                <!-- Menu Calorie-->
                                <h3 class="fw-light text-muted">{{menu.calorie}} Kcal</h3>
                                
                            </div>
                        </div>
    
                    </div>
                </div>
                <div class="portfolio-modal modal fade" id="portfolioModal{{menu.id}}" tabindex="-1" aria-labelledby="portfolioModal{{menu.id}}" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header border-0"><button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button></div>
                            <div class="modal-body text-center pb-5">
                                <div class="container">
                                    <div class="row justify-content-center">
                                        <div class="col-lg-8">
                                            {% if menu.is_best_menu %}
                                                <div class='bestmenu_detail bg-primary bg-gradient rounded-pill mb-2'>BEST MENU</div>
                                            {% endif %}

                                            <!-- Portfolio Modal - Image-->
                                            <img class="img-fluid rounded mb-5" src="{{menu.image|fix_route|default:'https://dummyimage.com/450x300/dee2e6/6c757d.jpg'}}" alt="..." />

                                            <div style="text-align: left;">
                                                <!-- Portfolio Modal - Title-->
                                                <h1 class="menu-modal-title text-secondary text-uppercase">{{menu.title}}</h1>
                                                <h1 class="menu-modal-en-title text-secondary text-uppercase">{{menu.en_title|default:'AMERICANO'}}</h1><br>

                                                <!-- Portfolio Modal - Text-->
                                                <p class="mb-4 menu-modal-desc">{{menu.desc}}</p>
                                            </div>
                                            <button class="btn btn-in-modal btn-primary" data-bs-dismiss="modal" id="addToCart--{{menu.title}}">
                                                <i class="fas fa-xmark fa-fw"></i>
                                                장바구니 담기
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

</section>
  
 <script>
    let tabButton = document.querySelectorAll('[id^=menu_type]');
    
    // 음료 카테고리에 따른 탭 메뉴 처리
    const tabButtonClickHandle = (e) =>{
        if (e.target !== e.currentTarget) return;
        e.preventDefault();
        
        let id = e.target.id.split("--")[1];
        console.log("selected " + id);
        
        let prevElement = document.querySelector('[class^=on]');
        let prev_id = prevElement.id.split("--")[1];

        $("#menu_type--" + prev_id).removeClass("on");
        $("#menu_content--" + prev_id).hide();
        
        $("#menu_type--" + id).addClass("on");
        $("#menu_content--" + id).show();
    }

    for(let i=0;i<tabButton.length;i++){
        tabButton[i].addEventListener('click',tabButtonClickHandle);
    }

</script>




{% endblock%}

{% block bar %}

<style>
    .cart-py-5 {
        padding-top: 9rem !important;
        padding-bottom: 1rem !important;
    }
    .sidebar-py-5 {
        padding-top: 6rem !important;
        padding-bottom: 3rem !important;
    }

</style>

<div class="portfolio-item mx-auto">
    <!-- Product details-->
    <div class="card-body cart-py-5">
        <div class="text-center text-light-muted">
            <div id="bar--cart" class="text-center">
                <h1 class="text-light-muted fw-bolder" style="margin: 0 0 -1.5rem;">0</h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" fill="currentColor" class="bi bi-cart4" viewBox="0 0 16 16">
                    <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                </svg>
                <div class="row">
                    <h2 class="col-5 text-muted fw-bolder" style="text-align: right; padding-right: 10%;">￦</h2>
                    <h2 class="col-7 text-muted fw-bolder" id="total-money" style="text-align: left; padding-left: 5%;">0</h2>
                </div>

            </div>
        </div>
        
    </div>
    <div class="card-body sidebar-py-5">
        <div class="text-center text-light-muted">
            <div id="bar--drink">
                <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" fill="#F25168" class="bi bi-cup-straw" viewBox="0 0 16 16">
                    <path d="M13.902.334a.5.5 0 0 1-.28.65l-2.254.902-.4 1.927c.376.095.715.215.972.367.228.135.56.396.56.82 0 .046-.004.09-.011.132l-.962 9.068a1.28 1.28 0 0 1-.524.93c-.488.34-1.494.87-3.01.87-1.516 0-2.522-.53-3.01-.87a1.28 1.28 0 0 1-.524-.93L3.51 5.132A.78.78 0 0 1 3.5 5c0-.424.332-.685.56-.82.262-.154.607-.276.99-.372C5.824 3.614 6.867 3.5 8 3.5c.712 0 1.389.045 1.985.127l.464-2.215a.5.5 0 0 1 .303-.356l2.5-1a.5.5 0 0 1 .65.278zM9.768 4.607A13.991 13.991 0 0 0 8 4.5c-1.076 0-2.033.11-2.707.278A3.284 3.284 0 0 0 4.645 5c.146.073.362.15.648.222C5.967 5.39 6.924 5.5 8 5.5c.571 0 1.109-.03 1.588-.085l.18-.808zm.292 1.756C9.445 6.45 8.742 6.5 8 6.5c-1.133 0-2.176-.114-2.95-.308a5.514 5.514 0 0 1-.435-.127l.838 8.03c.013.121.06.186.102.215.357.249 1.168.69 2.438.69 1.27 0 2.081-.441 2.438-.69.042-.029.09-.094.102-.215l.852-8.03a5.517 5.517 0 0 1-.435.127 8.88 8.88 0 0 1-.89.17zM4.467 4.884s.003.002.005.006l-.005-.006zm7.066 0-.005.006c.002-.004.005-.006.005-.006zM11.354 5a3.174 3.174 0 0 0-.604-.21l-.099.445.055-.013c.286-.072.502-.149.648-.222z"/>
                </svg>
                <h1 class="fw-bolder" style="color: #F25168;">DRINK</h1>
            </div>
        </div>
        
    </div>

    <div class="card-body sidebar-py-5">
        <div class="text-center text-light-muted">
            <div id="bar--bread">
                <svg xmlns="http://www.w3.org/2000/svg" width="130" height="130" fill="currentColor" viewBox="0 0 512 512">
                    <path d="M256 32C192 32 0 64 0 192c0 35.3 28.7 64 64 64V432c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V256c35.3 0 64-28.7 64-64C512 64 320 32 256 32z"/>
                </svg>
                
                <h1 class="text-light-muted fw-bolder">BREAD</h1>
            </div>
        </div>
        
    </div>

    <div class="card-body sidebar-py-5">
        <div class="text-center text-light-muted">
            <img width="150" height="150" src="/static/assets/temp_logo.PNG" alt="logo" style="border-radius: 50%;"/>
        </div>
        
    </div>

</div>


<script>
        
    let addCartButton = document.querySelectorAll('[id^=addToCart]');
    // 장바구니 담기 처리
    const addCartButtonClickHandle = (e) =>{
        e.preventDefault();
        
        let id = e.target.id.split("--")[1];
        console.log("add " + id);
        
        // 주문한 상품 총 개수 수정
        var count = document.querySelector("#bar--cart > h1").innerText;
        count *= 1;
        document.querySelector("#bar--cart > h1").innerText = count + 1;

        // 주문 금액 수정
        var price = document.getElementById(id + '--price').innerText.split(' ')[0];
        price *= 1;

        var totalPrice = document.getElementById('total-money').innerText;
        totalPrice *= 1;
        document.getElementById('total-money').innerHTML = (totalPrice + price);

    }
    for(let i=0;i<addCartButton.length;i++){
        addCartButton[i].addEventListener('click', addCartButtonClickHandle);
    }
</script>


{% endblock %}