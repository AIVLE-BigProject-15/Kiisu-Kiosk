{% extends 'order.html' %} 

{% load post_extras %}
{% block content %}


<script>  
    function pay_now() { 
        var form = document.getElementById("confirmed_order_submission");
        var parm = new Array();

        let carts = [
                    {% for item in cart_all %}
                        {
                            id: "{{ item.id }}",
                        },
                    {% endfor %}
                ]
        var orders = new Array();
        for (let i=0; i < carts.length; i++){
            orders.push(carts[i].id);
        }
        console.log(orders);
        parm.push( ['usage_type', "{{usage_type|safe}}"] );
        parm.push( ['orders', orders] );
        parm.push( ['total_price', "{{total_price|safe}}"] );

        var input = new Array();
        for (var i = 0; i < parm.length; i++) {
            input[i] = document.createElement("input");
            input[i].setAttribute("type", "hidden");
            input[i].setAttribute('name', parm[i][0]);
            input[i].setAttribute("value", parm[i][1]);
            form.appendChild(input[i]);
        }
        document.body.appendChild(form);
        form.submit();
    }

</script>

<style>
    .bottombar {
        width: 85.8%;
        position: fixed;
        bottom: 0;
        margin: auto;
        align-items: center;
        justify-content: center;
        padding-top: 0.5rem;
        padding-bottom: 0rem;
    }
    #totalPrice {
        width: 600px;
        border-style: solid;
        border-color: gray;
        border-width: 0px 0px 2px 0px;
        margin: auto;
        display : flex;
        padding: 3% 0 0 0;
    }
    .cart-info {
        border-radius: 35px 35px 0px 0px; 
        width: 100%; 
        padding: 1rem 1rem;
    }
    .payment {
        width: 100%;
        margin: auto;
    }
    .payment1 {
        width: 100%;
        margin: auto;
        position: fixed;
        top:0;
    }

    #card-pay {
        width: 50%;
        height: 140px;
        color: #000000;
        background-color: #F2F2F2;
    }
    #app-pay {
        width: 50%;
        height: 140px;
        color: #ffffff;
        background-color: #E51937;
    }
    #cart-list > * {
        color: #fff;
        text-align: center;
        font-size: 1.25rem;
        padding-bottom: 0.5rem;
        
    }
    #cartElement {
        text-align: left;
        padding-left: 2rem;
    }
</style>

<!-- Header-->
<div class="py-3">
	<div class="container px-1">
        <div class="payment1">
            <div class="row">
        <h1 class="fw-bolder mt-4 mb-3 text-start">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;주문 내역</h1><br>
            </div>
        </div>
        
		<section class="py-3">
            <div class="container my-5 py-5">
                <div class="row gx-3"> 
                    {% for item in cart_all %} 
                        <div class='col-lg-4 col-4 mt-5'>
                            <div class='card h-100 border-1'>
                                <img class='card-img-top' src={{item.menu.image|fix_route|default:'https://dummyimage.com/600x400/403f40/d4d4d4.png'}} />
                                <div class='card-body'>
                                    <a class='text-decoration-none link-dark stretched-link text-center'>
                                        <h5 class='card-title mb-3'>
                                            <strong>{{item.menu.title}} </strong>
                                        </h5>
                                    </a>
                                    <p class='card-text mb-0 text-center'>수량 : {{item.count}}</p>
                                </div>
                            </div>
                        </div> 
                    {% endfor %} 
                </div>
            </div>
        </section>
	</div>
</div>

<section class="bottombar">
    <div class="row gx-9 mt-3 mb-3" id="totalPrice">
        <div class="col-7"><h3 class="fw-bolder mt-3 mb-3 text-start">&nbsp;&nbsp;&nbsp;총 주문 금액</h3></div>
        <div class="col-5"><h3 class="fw-bolder mt-3 mb-3 text-danger text-end">{{total_price|default:0}}원&nbsp;&nbsp;&nbsp;</h3></div>
    </div>

<div class="payment">
    <div class="row">
        <h3 class="fw-bolder mt-3 mb-3 text-start">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;결제 수단선택</h3></div>
        <div id="card-pay" class="py-5 mt-3" OnClick="window.history.back();" style="cursor:pointer; float:left;">
            <h1 class="fw-bolder align-items-center"><i class="bi bi-credit-card"></i> 카드 결제</h1>
        </div>
        <div id="app-pay" class="py-5 mt-3" OnClick="pay_now();" style="cursor:pointer; float:left;">
            <h1 class="fw-bolder text-center"><i class="bi bi-upc-scan"></i> 간편 결제</h1>
        </div>
</div>


</section>
{% endblock content %}
            

{% block bar %}
<div class="portfolio-item mx-auto">
    <!-- Product details-->
    <div class="card-body cart-py-5">
        <div class="side_tab_title text-light-muted">
            <div id="bar--cart" class="off" style="cursor:pointer;">
                <h2 class="fw-bolder" style="margin: 0 0 -1rem; pointer-events: none;">0</h2>
                <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" fill="currentColor" class="bi bi-cart4" viewBox="0 0 16 16" style="pointer-events: none;">
                    <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                </svg>
                <div class="row">
                    <h5 class="col-5 fw-bolder" style="text-align: right; padding-right: 5%; pointer-events: none;">￦</h5>
                    <h5 class="col-7 fw-bolder" id="total-money" style="text-align: left; padding-left: 5%; pointer-events: none;">0</h5>
                </div>

            </div>
        </div>
        
    </div>
    <div class="card-body sidebar-py-5">
        <div class="side_tab_title text-light-muted">
            <div id="bar--drink" class="on" style="cursor:pointer;">
                <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" fill="currentColor" class="bi bi-cup-straw" viewBox="0 0 16 16" style="pointer-events: none;">
                    <path d="M13.902.334a.5.5 0 0 1-.28.65l-2.254.902-.4 1.927c.376.095.715.215.972.367.228.135.56.396.56.82 0 .046-.004.09-.011.132l-.962 9.068a1.28 1.28 0 0 1-.524.93c-.488.34-1.494.87-3.01.87-1.516 0-2.522-.53-3.01-.87a1.28 1.28 0 0 1-.524-.93L3.51 5.132A.78.78 0 0 1 3.5 5c0-.424.332-.685.56-.82.262-.154.607-.276.99-.372C5.824 3.614 6.867 3.5 8 3.5c.712 0 1.389.045 1.985.127l.464-2.215a.5.5 0 0 1 .303-.356l2.5-1a.5.5 0 0 1 .65.278zM9.768 4.607A13.991 13.991 0 0 0 8 4.5c-1.076 0-2.033.11-2.707.278A3.284 3.284 0 0 0 4.645 5c.146.073.362.15.648.222C5.967 5.39 6.924 5.5 8 5.5c.571 0 1.109-.03 1.588-.085l.18-.808zm.292 1.756C9.445 6.45 8.742 6.5 8 6.5c-1.133 0-2.176-.114-2.95-.308a5.514 5.514 0 0 1-.435-.127l.838 8.03c.013.121.06.186.102.215.357.249 1.168.69 2.438.69 1.27 0 2.081-.441 2.438-.69.042-.029.09-.094.102-.215l.852-8.03a5.517 5.517 0 0 1-.435.127 8.88 8.88 0 0 1-.89.17zM4.467 4.884s.003.002.005.006l-.005-.006zm7.066 0-.005.006c.002-.004.005-.006.005-.006zM11.354 5a3.174 3.174 0 0 0-.604-.21l-.099.445.055-.013c.286-.072.502-.149.648-.222z"/>
                </svg>
                <h3 class="fw-bolder" style="pointer-events: none;">DRINK</h3>
            </div>
        </div>
        
    </div>

    <div class="card-body sidebar-py-5">
        <div class="side_tab_title text-light-muted">
            <div id="bar--bread" class="off" style="cursor:pointer;">
                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" viewBox="0 0 512 512" style="pointer-events: none;">
                    <path d="M256 32C192 32 0 64 0 192c0 35.3 28.7 64 64 64V432c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V256c35.3 0 64-28.7 64-64C512 64 320 32 256 32z"/>
                </svg>
                
                <h3 class="fw-bolder" style="pointer-events: none;">BREAD</h3>
            </div>
        </div>
        
    </div>

    <div class="card-body sidebar-py-5">
        <div class="text-center text-light-muted">
            <img width="80" height="80" src="/static/assets/temp_logo.PNG" alt="logo" style="border-radius: 50%;"/>
        </div> 
        
    </div>

</div>

<script>
    let sideTabButton = document.querySelectorAll('[id^=bar]');
    
    // 음료 카테고리에 따른 탭 메뉴 처리
    const sideTabButtonClickHandle = (e) =>{
        if (e.target !== e.currentTarget) return;
        e.preventDefault();
        
        let id = e.target.id.split("--")[1];
        console.log("selected " + id);
        
        let prevElement = document.querySelector('.side_tab_title [class^=on]');
        let prev_id = prevElement.id.split("--")[1];

        $("#bar--" + prev_id).removeClass("on");
        $("#bar--" + prev_id).addClass("off");

        $("#bar-content--" + prev_id).hide();
        
        $("#bar--" + id).removeClass("off");
        $("#bar--" + id).addClass("on");
        $("#bar-content--" + id).show();
    }

    for(let i=0;i<sideTabButton.length;i++){
        sideTabButton[i].addEventListener('click',sideTabButtonClickHandle);
    }
</script>
<script src="/static/js/order.js"></script>

{% endblock %}