{% extends 'index.html' %} 

{% load post_extras %}
{% block content %}


<script>  
    function pay_now() { 
        var form = document.getElementById("confirmed_order_submission");
        var parm = new Array();

        let carts = [
                    {% for item in cart_all %}
                        {
                            id: "{{ item.id }}",
                        },
                    {% endfor %}
                ]
        var orders = new Array();
        for (let i=0; i < carts.length; i++){
            orders.push(carts[i].id);
        }
        console.log(orders);
        parm.push( ['usage_type', "{{usage_type|safe}}"] );
        parm.push( ['orders', orders] );
        parm.push( ['total_price', "{{total_price|safe}}"] );

        var input = new Array();
        for (var i = 0; i < parm.length; i++) {
            input[i] = document.createElement("input");
            input[i].setAttribute("type", "hidden");
            input[i].setAttribute('name', parm[i][0]);
            input[i].setAttribute("value", parm[i][1]);
            form.appendChild(input[i]);
        }
        document.body.appendChild(form);
        form.submit();
    }

</script>

<style>
    #totalCount, #totalPrice {
        border-style: solid;
        border-color: gray;
        border-width: 0px 0px 1px 0px;
        margin: 0 0 0 0;
        align-items : center;
        display : flex;
        padding: 3% 0 0 0;

    }
</style>

<!-- Header-->
<div class="py-5">
	<div class="container px-4">
        <h1 class="display-5 fw-bolder mb-2">주문 내역을 확인해주세요</h1><br>

        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="row gx-4 gx-lg-5" id="totalCount">
                <div class="col-9"><h2 class="fw-normal mb-4">총 주문 수량</h2></div>
                <div class="col-3"><h2 class="fw-normal mb-4">{{total_count|default:0}}</h2></div>
            </div>

            <div class="row gx-4 gx-lg-5" id="totalPrice">
                <div class="col-9"><h2 class="fw-normal mb-4">총 주문 금액</h2></div>
                <div class="col-3"><h2 class="fw-normal mb-4">{{total_price|default:0}}원</h2></div>
            </div>
        </div>        
        
		<section class="py-3">
            <div class="container my-5 mt-4">
                <div class="row gx-3"> 
                    {% for item in cart_all %} 
                        <div class='col-lg-3 col-4 mt-3'>
                            <div class='card h-100 border-1'>
                                <img class='card-img-top' src={{item.menu.image|fix_route|default:'https://dummyimage.com/600x400/403f40/d4d4d4.png'}} />
                                <div class='card-body'>
                                    <a class='text-decoration-none link-dark stretched-link text-center'>
                                        <h5 class='card-title mb-3'>
                                            <strong>{{item.menu.title}} </strong>
                                        </h5>
                                    </a>
                                    <p class='card-text mb-0 text-center'>수량 : {{item.count}}</p>
                                </div>
                            </div>
                        </div> 
                    {% endfor %} 
                </div>
            </div>
        </section>
	</div>

</div>
{% endblock content %}
            

{% block cart %}

<style>
    .bottombar {
        position: fixed;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1030;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        padding-top: 0.5rem;
        padding-bottom: 0rem;
      }
    .cart-info {
        border-radius: 35px 35px 0px 0px; 
        width: 100%; 
        padding: 1rem 1rem;
    }
    .payment {
        width: 100%; 
    }
    #pay-cancel, #pay {
        width: 50%; 
        text-align: center;
        padding-top: 1rem;
-    }
    #pay-cancel {
        color: #fff;
        background-color: #BEBEBE;
    }
    #pay {
        color: #ffffff;
        background-color: #FF0000;
    }
    #pay-cancel:hover {
        color: #555555;
        background-color: #E8E8E8;
    }
    #pay:hover {
        color: #ffffff;
        background-color: #9B111E;
    }
    #cart-list > * {
        color: #fff;
        text-align: center;
        font-size: 1.25rem;
        padding-bottom: 0.5rem;
        
    }
    #cartElement {
        text-align: left;
        padding-left: 2rem;
    }
</style>

<section class="bottombar">
    <form id="confirmed_order_submission" action="{% url 'cafe:old_pay' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
    </form>
    
    <div class="payment">
        <div class="row">
            <div id="pay-cancel" class="py-5" OnClick="window.history.back();" style="cursor:pointer;" >
                <h3 class="fw-bolder">취소</h3>
            </div>
            <div id="pay" class="py-5" OnClick="pay_now();" style="cursor:pointer;">
                <h3>결제하기</h3>
            </div>
        </div>
    </div>
   

</section>

{% endblock %}